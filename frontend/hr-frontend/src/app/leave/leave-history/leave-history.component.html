<div class="leave-history-container">
  <div class="header">
    <h2 class="title">Leave History</h2>
    <p class="subtitle">View and manage your leave requests</p>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <div class="filter-group">
      <label for="status-filter" class="filter-label">Status</label>
      <select
        id="status-filter"
        [(ngModel)]="statusFilter"
        (change)="onStatusFilterChange()"
        class="filter-select"
      >
        <option value="all">All Statuses</option>
        <option value="pending">Pending</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
        <option value="cancelled">Cancelled</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="search" class="filter-label">Search</label>
      <input
        type="text"
        id="search"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        placeholder="Search by leave type or reason..."
        class="filter-input"
      />
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">Loading...</div>
  </div>

  <!-- Error State -->
  <div class="error-banner" *ngIf="error">
    <span class="error-icon">‚ö†Ô∏è</span>
    <span>{{ error }}</span>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && filteredRequests.length === 0">
    <span class="empty-icon">üìã</span>
    <p class="empty-text">No leave requests found</p>
  </div>

  <!-- Leave Requests Table -->
  <div class="table-container" *ngIf="!isLoading && filteredRequests.length > 0">
    <table class="leave-table">
      <thead>
        <tr>
          <th>Leave Type</th>
          <th>Dates</th>
          <th>Days</th>
          <th>Status</th>
          <th>Submitted</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let request of filteredRequests" class="table-row">
          <td class="leave-type-cell">
            <span class="leave-type-badge">{{ request.leave_type | titlecase }}</span>
          </td>
          <td>
            <span class="date-text">{{ formatDate(request.start_date) }} - {{ formatDate(request.end_date) }}</span>
          </td>
          <td>
            <span class="days-badge">{{ request.days_requested }} days</span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(request.status)">
              <span class="status-icon">{{ getStatusIcon(request.status) }}</span>
              {{ request.status | titlecase }}
            </span>
          </td>
          <td>
            <span class="date-text">{{ formatDate(request.submitted_at) }}</span>
          </td>
          <td class="actions-cell">
            <div class="action-buttons">
              <button
                class="btn-view"
                (click)="viewReasoning(request)"
                *ngIf="request.llm_reasoning"
                title="View AI reasoning"
              >
                View
              </button>
              <button
                class="btn-cancel"
                (click)="cancelRequest(request)"
                *ngIf="canCancel(request)"
                title="Cancel request"
              >
                Cancel
              </button>
              <span class="no-actions" *ngIf="!request.llm_reasoning && !canCancel(request)">-</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Reasoning Modal -->
  <div class="modal-overlay" *ngIf="showReasoningModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">AI Decision Reasoning</h3>
        <button class="btn-close" (click)="closeModal()">‚úï</button>
      </div>
      <div class="modal-body" *ngIf="selectedRequest">
        <div class="request-details">
          <p><strong>Leave Type:</strong> {{ selectedRequest.leave_type | titlecase }}</p>
          <p><strong>Dates:</strong> {{ formatDate(selectedRequest.start_date) }} - {{ formatDate(selectedRequest.end_date) }}</p>
          <p><strong>Days:</strong> {{ selectedRequest.days_requested }}</p>
          <p><strong>Reason:</strong> {{ selectedRequest.reason }}</p>
        </div>
        <app-llm-reasoning-display
          *ngIf="selectedRequest.llm_decision"
          [decision]="getDecision(selectedRequest.llm_decision)"
          [reasoning]="selectedRequest.llm_reasoning || 'No reasoning available'"
          [confidence]="0.85"
          [factors]="[]"
          [recommendations]="[]"
        ></app-llm-reasoning-display>
        <p *ngIf="!selectedRequest.llm_decision" class="no-reasoning">No AI reasoning available for this request.</p>
      </div>
    </div>
  </div>
</div>
